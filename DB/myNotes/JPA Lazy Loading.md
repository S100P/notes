# –ï–°–õ–ò –ë–£–î–ï–¢ –ù–ï –ü–û–ù–Ø–¢–ù–û, –ß–ò–¢–ê–ô RAW –í–ï–†–°–ò–Æ –ù–ò–ñ–ï, –¢.–ö. –≠–¢–û–¢ .MD –†–ï–î–ê–ö–¢–ò–†–û–í–ê–õ –ß–ê–¢ –ù–ê –ï–ï –û–°–ù–û–í–ï!

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ JPA –∏ Spring Boot

## 1. Fetch.LAZY –∏ –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏

–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ **–Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è**, –µ—Å–ª–∏ –∫ –Ω–∏–º –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è. –ü–æ—ç—Ç–æ–º—É –∫ –ø–æ–ª—è–º —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ **–Ω—É–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å** `Fetch.LAZY`:

```java
@Entity
public class Author {
    @OneToMany(mappedBy = "author", fetch = FetchType.LAZY)
    private List<Book> books;
}
```

## 2. –ü—Ä–æ–±–ª–µ–º–∞ LazyInitializationException –∏ open-in-view=false

`Fetch.LAZY` –ø–æ—Ä–æ–∂–¥–∞–µ—Ç **–ø—Ä–æ–±–ª–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π** –Ω–∞ —ç—Ç–∞–ø–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (–µ—Å–ª–∏ —Ç–∞–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏). –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å, **–Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** `open-in-view = false`.

–≠—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Spring Boot **–∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é Hibernate –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞**, –∞ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ—ë –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞.

–ü—Ä–∏ open-in-view=true —Å–µ—Å—Å–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Thymeleaf –∏–ª–∏ JSP), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–∂–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ/—à–∞–±–ª–æ–Ω–µ.

üìå **–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [JPA open-in-view=true –∏ @Transactional](https://github.com/S100P/notes/blob/main/DB/JPA.open-in-view%3Dtrue%20%D0%B8%20%40Transactional.md)

## 3. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Fetch.LAZY –ø—Ä–∏ open-in-view=false

–ö–æ–≥–¥–∞ `open-in-view = false`, **—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å `Fetch.LAZY` –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç**. –ü–æ—ç—Ç–æ–º—É –≤ –º–µ—Ç–æ–¥–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –≥–¥–µ –Ω—É–∂–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, **–Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Ö –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ `@EntityGraph`**:

```java
@EntityGraph(attributePaths = {"books", "publishers"})
Optional<Author> findById(Long id);
```

‚òë –≠—Ç–æ **–ø–æ–∑–≤–æ–ª–∏—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å—Ä–∞–∑—É –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ** –∏ –∏–∑–±–µ–∂–∞—Ç—å **'N+1' –ø—Ä–æ–±–ª–µ–º—ã**. 
(–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ N+1 ‚Äî —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ 100 –∞–≤—Ç–æ—Ä–æ–≤, –∞ –ø–æ—Ç–æ–º –µ—â–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–Ω–∏–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞)


## 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: @Transactional(readOnly = true)

–ö—Ä–æ–º–µ `@EntityGraph`, –º–æ–∂–Ω–æ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Transactional` –Ω–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–º –º–µ—Ç–æ–¥–µ**. Spring –æ—Ç–∫—Ä–æ–µ—Ç **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –≤–µ—Å—å –º–µ—Ç–æ–¥**, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å `LAZY` —Å–≤—è–∑–∏ –±–µ–∑ `LazyInitializationException`:

```java
@Transactional(readOnly = true)
public Author getAuthorById(Long id) {
    return authorRepository.findById(id).orElseThrow();
}

    @GetMapping("/author")
    public Author getAuthor(Long id) {
        vat = service.getAuthorById(id); // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∑–¥–µ—Å—å (–ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞)
        // –°–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞!
      .....
    }
}
```
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ @Transaction(readOnly=true):
‚úÖ Hibernate –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å LAZY —Å–≤—è–∑–∏ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤ —Ä–∞–º–∫–∞—Ö –º–µ—Ç–æ–¥–∞ (–±–µ–∑ LazyInitializationException). 
‚úÖ Spring –æ—Ç–∫–ª—é—á–∞–µ—Ç flush(), —É–º–µ–Ω—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Hibernate.
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç "—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é" –≤ –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å read-only —Ä–µ–ø–ª–∏–∫–∏).
‚úÖ  –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Persistence Context, —Å–Ω–∏–∂–∞—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.
‚ö† **–ù–æ!**  –ï—Å–ª–∏ LAZY —Å–≤—è–∑–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º–∞.

üìå **–ü–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@EntityGraph` –∏ `@Transactional(readOnly=true)` –≤–º–µ—Å—Ç–µ.**

## 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ü–∏–π

–í `GET`-–º–µ—Ç–æ–¥–∞—Ö **–Ω–µ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≤—Å—è —Å—É—â–Ω–æ—Å—Ç—å**, –∞ —Ç–æ–ª—å–∫–æ **–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è**. –ü–æ–º–∏–º–æ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ DTO, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏**:

```java
public interface AuthorProjection {
    String getName();
    List<BookProjection> getBooks();
}

public interface BookProjection {
    String getTitle();
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
‚úÖ JPA **—Å–æ–∑–¥–∞—Å—Ç SQL-–∑–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è**, –∞ –Ω–µ –Ω–∞ –≤—Å—é —Å—É—â–Ω–æ—Å—Ç—å.  
‚úÖ –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î ‚Üí **–ª—É—á—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**.  

üìå **–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [Spring Projections](https://github.com/S100P/notes/blob/main/DB/%D0%98%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%BD%D1%8B%D0%B5%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%20(%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8)%20%5BSpring%20Projections%5D.md)

## 6. –ü—Ä–æ–±–ª–µ–º–∞ Fetch.LAZY –≤ –ø—Ä–æ–µ–∫—Ü–∏—è—Ö –∏ —Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ @Query

‚ö† **–ï—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ `LAZY`-—Å—É—â–Ω–æ—Å—Ç—å**, Spring JPA **–Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è**. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ **–Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `@Query`**: 

```java
@Query("SELECT a.name, b.title FROM Author a JOIN a.books b WHERE a.id = :id")
AuthorProjection findAuthorById(Long id);
```
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —è–≤–Ω–æ (—á–µ—Ä–µ–∑ @Query), Spring Data JPA:
–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏.
–î–ª—è getChild() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ –ø—Ä–æ–µ–∫—Ü–∏—é, –∞ –ø—Ä–æ–∫—Å–∏ —Å—É—â–Ω–æ—Å—Ç–∏ Child (—Ç–∞–∫ –∫–∞–∫ —Å–≤—è–∑—å FetchType.LAZY).
–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –º–µ—Ç–æ–¥–∞–º ChildProjection (–Ω–∞–ø—Ä–∏–º–µ—Ä, getChildName()) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ Child (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å SELECT * FROM child).
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ ChildProjection –∏–∑ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

- **–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞!**

üìå **–ü–æ–¥—Ä–æ–±–Ω–µ–µ:**  
- [Fetch.LAZY –∏ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–µ–π](https://github.com/S100P/notes/blob/main/DB/Fetch.lazy/R1.%20%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B8.%20%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA%20%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8%20%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9%20%D1%81%D1%83%D1%89%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B9.md)

## 7. –ü—Ä–æ–±–ª–µ–º–∞ —Å–ø–∏—Å–∫–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ü–∏—è—Ö –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Hibernate

‚ö† **–ï—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ (`List<ChildProjection>`), —Ç–æ `@Query` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç**. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ Hibernate**.

üìå **–†–µ—à–µ–Ω–∏—è:**  
- –†–∞–∑–±–∏—Ç—å –Ω–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤** (–æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å `ParentProjection` –∏ `List<ChildProjection>`).  
- **–°–µ—Ç—Ç–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã –≤—Ä—É—á–Ω—É—é –≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–º –º–µ—Ç–æ–¥–µ**.

üìå **–ü–æ–¥—Ä–æ–±–Ω–µ–µ:**  
- [–ü—Ä–æ–±–ª–µ–º–∞ Fetch.LAZY –≤ –ø—Ä–æ–µ–∫—Ü–∏—è—Ö](https://github.com/S100P/notes/blob/main/DB/Fetch.lazy/R1.%20%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0%20%D1%81%20Fetch.lazy%3B%20%D0%B2%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%BD%D1%8B%D1%85%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D1%8F%D1%85.md)

---

## **–í—ã–≤–æ–¥**

- **–ò—Å–ø–æ–ª—å–∑—É–µ–º `Fetch.LAZY`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.**
- **–°—Ç–∞–≤–∏–º `open-in-view=false`, —á—Ç–æ–±—ã Hibernate –Ω–µ –¥–µ—Ä–∂–∞–ª —Å–µ—Å—Å–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π.**
- **–ò—Å–ø–æ–ª—å–∑—É–µ–º `@EntityGraph` –∏ `@Transactional(readOnly=true)` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `LAZY` —Å–≤—è–∑–µ–π.**
- **–î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ `SELECT`-–∑–∞–ø—Ä–æ—Å–æ–≤ –ª—É—á—à–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å Spring Projections.**
- **–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ü–∏–π —Å –ø–æ–ª—è–º–∏ –≤ –≤–∏–¥–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö `LAZY` –ø—Ä–æ–µ–∫—Ü–∏–π –∏ –∂–µ–ª–∞–Ω–∏–∏ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, –Ω–∞–¥–æ —è–≤–Ω–æ –ø–∏—Å–∞—Ç—å `@Query`.**
- **–ï—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ (`List<ChildProjection>`), —Ç–æ `@Query` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç**.

---
RAW VERSION
---

1.–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è, –µ—Å–ª–∏ –∫ –Ω–∏–º –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –∫ –ø–æ–ª—è–º —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –º—ã —Å—Ç–∞–≤–∏–º Fetch.LAZY.


2. –û–¥–Ω–∞–∫–æ Fetch.LAZY –ø–æ—Ä–æ–∂–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞ —ç—Ç–∞–ø–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (—Ç.–∫. —Ç–∞–º –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏), –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º open-in-view = false. –≠—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Spring Boot, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é Hibernate –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞, –∞ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ—ë –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞.

https://github.com/S100P/notes/blob/main/DB/JPA.open-in-view%3Dtrue%20%D0%B8%20%40Transactional.md

3. –ü—Ä–∏ open-in-view = false —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å Fetch.LAZY –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç, –ø–æ—ç—Ç–æ–º—É –≤ –º–µ—Ç–æ–¥–∞—Ö (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è), –≥–¥–µ –Ω–∞–º –Ω—É–∂–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∏—Ö –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ @EntityGraph. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —Å—Ä–∞–∑—É –∏ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ, —á—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É 'N+1' –∑–∞–ø—Ä–æ—Å–∞.

4. –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –ø.3 –º–æ–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ @EntityGraph, –Ω–æ –∏ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ @Transactional –Ω–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–º –º–µ—Ç–æ–¥–µ. Spring –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –≤–µ—Å—å –º–µ—Ç–æ–¥, –∞ –∑–Ω–∞—á–∏—Ç:
‚úÖ Hibernate –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å LAZY —Å–≤—è–∑–∏ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤ —Ä–∞–º–∫–∞—Ö –º–µ—Ç–æ–¥–∞ (–±–µ–∑ LazyInitializationException). 
‚úÖ Spring –æ—Ç–∫–ª—é—á–∞–µ—Ç flush(), —É–º–µ–Ω—å—à–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Hibernate.
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç "—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é" –≤ –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å read-only —Ä–µ–ø–ª–∏–∫–∏).
‚úÖ  –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Persistence Context, —Å–Ω–∏–∂–∞—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.
‚úÖ –ù–æ! –ï—Å–ª–∏ LAZY —Å–≤—è–∑–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º–∞.

–ü–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @EntityGraph –∏ @Transactional (–∏–ª–∏ @Transactional(readOnly=true)) –≤–º–µ—Å—Ç–µ.

5. –ó–∞—á–∞—Å—Ç—É—é –≤ get –º–µ—Ç–æ–¥–∞—Ö –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å—é —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ –ë–î, –∞ –Ω—É–∂–Ω—ã –ª–∏—à—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –µ–µ –ø–æ–ª—è, –ø–æ—ç—Ç–æ–º—É –ø–æ–º–∏–º–æ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ –î–¢–û —Å –æ—Ç—Ñ–∏–ª—Ç—Ä–æ–≤—ã–≤–∞–Ω–∏–µ–º –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π, –µ—Å—Ç—å –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏.

https://github.com/S100P/notes/blob/main/DB/%D0%98%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%BD%D1%8B%D0%B5%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%20(%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8)%20%5BSpring%20Projections%5D.md 

–≠—Ç–æ —Å—É—â–Ω–æ—Å—Ç—å Spring JPA, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ü–∏—é —Å—É—â–Ω–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏, –∞ –º–µ—Ç–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Ç–∞–∫—É—é –ø—Ä–æ–µ–∫—Ü–∏—é –±—É–¥–µ—Ç —Å–æ–∑–¥–∞—Ç—å sql –∑–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –ª–∏—à—å –Ω–∞ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, –∞ –Ω–µ –Ω–∞ –≤—Å—é —Å—É—â–Ω–æ—Å—Ç—å. 

6. –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–º —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ —Å Fetch.LAZY, —Ç–æ Spring JPA –Ω–µ —Å–º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (–∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ —Ç–∞–∫–æ–π —Å–≤—è–∑–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏), –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —è–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ç–∞–∫–∏–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ @Query.

–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —è–≤–Ω–æ (—á–µ—Ä–µ–∑ @Query), Spring Data JPA:
–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—è, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏.
–î–ª—è getChild() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ –ø—Ä–æ–µ–∫—Ü–∏—é, –∞ –ø—Ä–æ–∫—Å–∏ —Å—É—â–Ω–æ—Å—Ç–∏ Child (—Ç–∞–∫ –∫–∞–∫ —Å–≤—è–∑—å FetchType.LAZY).
–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –º–µ—Ç–æ–¥–∞–º ChildProjection (–Ω–∞–ø—Ä–∏–º–µ—Ä, getChildName()) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ Child (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å SELECT * FROM child).
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ ChildProjection –∏–∑ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

7. –ï—Å–ª–∏ –∂–µ –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –ø—Ä–æ–µ–∫—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ —Å–ø–∏—Å–∫–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∞–Ω–Ω–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏, —Ç–æ @Query –∑–∞–ø—Ä–æ—Å –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π hibenate. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ (—Ä–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ–µ–∫—Ü–∏–∏, –ø–æ—Ç–æ–º —Å–µ—Ç—Ç–∏—Ç—å –¥–æ—á–µ—Ä–Ω—é—é –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–º –º–µ—Ç–æ–¥–µ –∏ –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã).

https://github.com/S100P/notes/blob/main/DB/Fetch.lazy/R1.%20%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B8.%20%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA%20%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8%20%D0%BF%D0%BE%D0%BB%D0%B5%D0%B9%20%D1%81%D1%83%D1%89%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D0%B9.md

https://github.com/S100P/notes/blob/main/DB/Fetch.lazy/R1.%20%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0%20%D1%81%20Fetch.lazy%3B%20%D0%B2%20%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%BD%D1%8B%D1%85%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%86%D0%B8%D1%8F%D1%85.md
